# $CoreSDI: Makefile.in,v 1.26 2000/07/10 23:58:39 claudio Exp $
#
# Copyright (c) 2000, Core SDI S.A., Argentina
# All rights reserved
# 
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
# 3. Neither name of the Core SDI S.A. nor the names of its contributors
#    may be used to endorse or promote products derived from this software
#    without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
# NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#

CC=		@CC@
CFLAGS=		@CFLAGS@
LDFLAGS=	@LDFLAGS@
LDDFLAGS=	@LDDFLAGS@
CPPFLAGS=	@CPPFLAGS@
CPPFLAGS+=	-I.
LIBS=		@LIBS@

INSTALL=	@INSTALL@
prefix=		@prefix@
exec_prefix=	@exec_prefix@
INSTALL_DIR=	@sbindir@

PROG=		syslogd
SRCS=		modules.c syslogd.c ttymsg.c static_modules.c
OBJS=		$(SRCS:.c=.o)
SSRCS=		@SSRCS@
SOBJS=		$(SSRCS:.c=.o)
SHASH_SRCS=	@SHASH_SRCS@
SHASH_OBJS=	$(SHASH_SRCS:.c=.o)

all: $(PROG)

.c.o:
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $< -o $@

modules.o: config.h

$(PROG): $(OBJS) MODULES
	$(CC) $(CFLAGS) $(CPPFLAGS) $(LDDFLAGS) $(LDFLAGS) $(LIBS) \
      	      $(OBJS) $(SOBJS:%=modules/%) $(SHASH_OBJS:%=modules/%) -o $@

MODULES:
	@cd modules && make && cd ..

.PHONY:	clean distclean

clean:
	-rm -f $(OBJS) core *.core $(PROG)

distclean: clean
	-rm -f Makefile config.h static_modules.c static_modules.h

install-prog:
	-$(INSTALL) $(PROG) $(INSTALL_DIR) ;

install: install-prog
	@echo -e \
	" **********************************************************\n"\
	"**********************************************************\n"\
	"**       A new syslog daemon was installed !!           **\n"\
	"**                                                      **\n"\
	"**   If previous syslogd wasn't msyslog                 **\n"\
	"**   you should change your syslog daemon               **\n"\
	"**   flags to msyslog's syntax (ie. -i)                 **\n"\
	"**                                                      **\n"\
	"**   RedHat Linux:                                      **\n"\
	"**                                                      **\n"\
	"**   Edit /etc/rc.d/init.d/syslog, and                  **\n"\
	"**   change the line \"daemon syslogd -m 0\"              **\n"\
	"**   to \"daemon syslogd -m 0 -i linux -i unix:/dev/log\" **\n"\
	"**                                                      **\n"\
	"**   OpenBSD:                                           **\n"\
	"**                                                      **\n"\
	"**   Edit /etc/rc.conf, and change the line             **\n"\
	"**   syslogd_flags=                                     **\n"\
	"**   to                                                 **\n"\
	"**   syslogd_flags=\"-i bsd -i unix:/dev/log\"            **\n"\
	"**                                                      **\n"\
	"**   UDP input                                          **\n"\
	"**                                                      **\n"\
	"**   Add to your flags '-i udp' or '-i udp <port>'      **\n"\
	"**   being <port> the port number you want it to        **\n"\
	"**   listen to.                                         **\n"\
	"**                                                      **\n"\
	"**   NOTE: your new syslogd daemon was installed on     **\n"\
	"**         directory  *** $(INSTALL_DIR) ***            **\n"\
	"**         if that wasn't your previous syslogd daemon  **\n"\
	"**         directory, either copy the new binary to the **\n"\
	"**         previous path, or change the path on the     **\n"\
	"**         calling script. On RedHat the file is        **\n"\
	"**         RedHat /etc/rc.d/init.d/syslogd, and for     **\n"\
	"**         OpenBSD is /etc/rc. We STRONGLY recommend    **\n"\
	"**         installing to real path (ie. /sbin/syslogd)  **\n"\
	"**         or /usr/sbin/syslogd)                        **\n"\
	"**                                                      **\n"\
	"**  PLEASE read the INSTALL and README files.           **\n"\
	"**                                                      **\n"\
	"**********************************************************\n"\
	"**********************************************************\n"
       

