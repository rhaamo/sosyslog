# $CoreSDI: Makefile.in,v 1.29 2000/07/10 19:55:51 claudio Exp $
#
# Copyright (c) 2000, Core SDI S.A., Argentina
# All rights reserved
# 
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
# 3. Neither name of the Core SDI S.A. nor the names of its contributors
#    may be used to endorse or promote products derived from this software
#    without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
# NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#

CC=		@CC@
LD=		ld
CFLAGS=		@CFLAGS@
LDFLAGS=	@LDFLAGS@
LDDFLAGS=	@LDDFLAGS@
DCCFLAGS=	@DCCFLAGS@
CPPFLAGS=	@CPPFLAGS@
CPPFLAGS+=	-I. -I.. 
LDCONFIG_FLAGS=	@LDCONFIG_FLAGS@
INSTALL_LIBDIR=	@INSTALL_LIBDIR@
UNAME=		@UNAME@

SSRCS=		@SSRCS@
SOBJS=		$(SSRCS:.c=.o)

DUNIX=		@Dunix@
DUNIX_SRCS=	@Dunix_SRCS@
DUNIX_OBJS=	$(DUNIX_SRCS:.c=.o)

DUDP=		@Dudp@
DUDP_SRCS=	@Dudp_SRCS@
DUDP_OBJS=	$(DUDP_SRCS:.c=.o)

DBSD=		@Dbsd@
DBSD_SRCS=	@Dbsd_SRCS@
DBSD_OBJS=	$(DBSD_SRCS:.c=.o)

DLINUX=		@Dlinux@
DLINUX_SRCS=	@Dlinux_SRCS@
DLINUX_OBJS=	$(DLINUX_SRCS:.c=.o)

DCLASSIC=	@Dclassic@
DCLASSIC_SRCS=	@Dclassic_SRCS@
DCLASSIC_OBJS=	$(DCLASSIC_SRCS:.c=.o)

DPEO=		@Dpeo@
DPEO_SRCS=	@Dpeo_SRCS@
DPEO_OBJS=	$(DPEO_SRCS:.c=.o)
SHASH_SRCS=	@SHASH_SRCS@
SHASH_OBJS=	$(SHASH_SRCS:.c=.o)
DHASH_SRCS=	@DHASH_SRCS@
DHASH_OBJS=	$(DHASH_SRCS:.c=.o)

DMYSQL=		@Dmysql@
DMYSQL_SRCS=	@Dmysql_SRCS@
DMYSQL_OBJS=	$(DMYSQL_SRCS:.c=.o)

DPGSQL=		@Dpgsql@
DPGSQL_SRCS=	@Dpgsql_SRCS@
DPGSQL_OBJS=	$(DPGSQL_SRCS:.c=.o)

DREGEX=		@Dregex@
DREGEX_SRCS=	@Dregex_SRCS@
DREGEX_OBJS=	$(DREGEX_SRCS:.c=.o)

DCC=	$(CC) $(CFLAGS) $(CPPFLAGS) $(DCCFLAGS) -c
LDK=	$(LD) -Bshareable


all: STATIC DYNAMIC

STATIC DYNAMIC_LIBS: ../config.h

STATIC: $(SOBJS)
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $(SSRCS) $(SHASH_SRCS:%=../peo/%)

DYNAMIC:	$(DUNIX) $(DUDP) $(DBSD) $(DLINUX) \
		$(DCLASSIC) $(DPEO) $(DMYSQL) $(DPGSQL) $(DREGEX)

$(DUNIX):
	$(DCC) $(DUNIX_SRCS)
	$(DLK) -o $@ $(DUNIX_OBJS)

$(DUDP): 
	$(DCC) $(DUDP_SRCS)
	$(LDK) -o $@ $(DUDP_OBJS)

$(DBSD):
	$(DCC) $(DBSD_SRCS)
	$(LDK) -o $@ $(DBSD_OBJS)

$(DLINUX):
	$(DCC) $(DLINUX_SRCS)
	$(LDK) -o $@ $(DLINUX_OBJS)

$(DCLASSIC):
	$(DCC) $(DCLASSIC_SRCS)
	$(LDK) -o $@ $(DCLASSIC_OBJS)

$(DPEO):
	$(DCC) $(DPEO_SRCS) $(DHASH_SRCS:%=../peo/%)
	$(LDK) -o $@ $(DPEO_OBJS) $(DHASH_OBJS)

$(DMYSQL):
	$(DCC) $(DMYSQL_SRCS)
	$(LDK) -o $@ $(DMYSQL_OBJS)

$(DPGSQL):
	$(DCC) $(DPGSQL_SRCS)
	$(LDK) -o $@ $(DPGSQL_OBJS)

$(DREGEX):
	$(DCC) $(DREGEX_SRCS)
	$(LDK) -o $@ $(DREGEX_OBJS)

.PHONY:	clean distclean

clean:
	-rm -f core *.core *.o *.so.*

distclean: clean
	-rm -f Makefile

install:
	@echo installing shared libraries...
	-install -m 111 -o root libmsyslog_*.so.* $(INSTALL_LIBDIR)
	@-if test "$(UNAME)" = "Linux"; \
	then \
		if test -z "`grep $(INSTALL_LIBDIR) /etc/ld.so.conf`"; \
		then \
			echo "$(INSTALL_LIBDIR)" >> /etc/ld.so.conf; \
		fi; \
		ldconfig; \
	else \
		ldconfig $(LDCONFIG_FLAGS) $(INSTALL_LIBDIR); \
	fi


