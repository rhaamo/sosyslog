# $CoreSDI: Makefile.in,v 1.51 2000/11/03 23:25:48 alejo Exp $
#
# Copyright (c) 2000, Core SDI S.A., Argentina
# All rights reserved
# 
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
# 3. Neither name of the Core SDI S.A. nor the names of its contributors
#    may be used to endorse or promote products derived from this software
#    without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
# NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#

CC=		@CC@
LD=		ld
CFLAGS=		@CFLAGS@ -Wall
LDFLAGS=	@LDFLAGS@
LDDFLAGS=	@LDDFLAGS@
DCCFLAGS=	@DCCFLAGS@
CPPFLAGS=	-I. -I.. 
CPPFLAGS+=	@CPPFLAGS@
LDCONFIG_FLAGS=	@LDCONFIG_FLAGS@

INSTALL=	@INSTALL@
prefix=		@prefix@
exec_prefix=	@exec_prefix@
INSTALL_LIBDIR=	@MSYSLOG_LIBDIR@
UNAME=		@UNAME@

SSRCS=		@SSRCS@
SOBJS=		$(SSRCS:.c=.o)

MSYSLOG_VERSION=@MSYSLOG_VERSION@

DUNIX=		@Dunix@
DUNIX_PLAIN=	@Dunix_PLAIN@
DUNIX_SRCS=	@Dunix_SRCS@
DUNIX_OBJS=	$(DUNIX_SRCS:.c=.o)

DUDP=		@Dudp@
DUDP_PLAIN=	@Dudp_PLAIN@
DUDP_SRCS=	@Dudp_SRCS@
DUDP_OBJS=	$(DUDP_SRCS:.c=.o)

DBSD=		@Dbsd@
DBSD_PLAIN=	@Dbsd_PLAIN@
DBSD_SRCS=	@Dbsd_SRCS@
DBSD_OBJS=	$(DBSD_SRCS:.c=.o)

DLINUX=		@Dlinux@
DLINUX_PLAIN=	@Dlinux_PLAIN@
DLINUX_SRCS=	@Dlinux_SRCS@
DLINUX_OBJS=	$(DLINUX_SRCS:.c=.o)

DDOORS=		@Ddoors@
DDOORS_PLAIN=	@Ddoors_PLAIN@
DDOORS_SRCS=	@Ddoors_SRCS@
DDOORS_OBJS=	$(DDOORS_SRCS:.c=.o)

DSTREAMS=	@Ddoors@
DSTREAMS_PLAIN=	@Ddoors_PLAIN@
DSTREAMS_SRCS=	@Ddoors_SRCS@
DSTREAMS_OBJS=	$(DSTREAMS_SRCS:.c=.o)

DCLASSIC=	@Dclassic@
DCLASSIC_PLAIN=	@Dclassic_PLAIN@
DCLASSIC_SRCS=	@Dclassic_SRCS@
DCLASSIC_OBJS=	$(DCLASSIC_SRCS:.c=.o)

DPEO=		@Dpeo@
DPEO_PLAIN=	@Dpeo_PLAIN@
DPEO_SRCS=	@Dpeo_SRCS@
DPEO_OBJS=	$(DPEO_SRCS:.c=.o)
SHASH_SRCS=	@SHASH_SRCS@
SHASH_OBJS=	$(SHASH_SRCS:.c=.o)
DHASH_SRCS=	@DHASH_SRCS@
DHASH_OBJS=	$(DHASH_SRCS:.c=.o)

DMYSQL=		@Dmysql@
DMYSQL_PLAIN=	@Dmysql_PLAIN@
DMYSQL_SRCS=	@Dmysql_SRCS@
MYSQL_CPPFLAGS=	@MYSQL_CPPFLAGS@
MYSQL_LIBS=	@MYSQL_LIBS@
DMYSQL_OBJS=	$(DMYSQL_SRCS:.c=.o)

DPGSQL=		@Dpgsql@
DPGSQL_PLAIN=	@Dpgsql_PLAIN@
DPGSQL_SRCS=	@Dpgsql_SRCS@
PGSQL_CPPFLAGS=	@PGSQL_CPPFLAGS@
PGSQL_LIBS=	@PGSQL_LIBS@
DPGSQL_OBJS=	$(DPGSQL_SRCS:.c=.o)

DREGEX=		@Dregex@
DREGEX_PLAIN=	@Dregex_PLAIN@
DREGEX_SRCS=	@Dregex_SRCS@
DREGEX_OBJS=	$(DREGEX_SRCS:.c=.o)

DCC=	$(CC) $(CFLAGS) $(CPPFLAGS) $(DCCFLAGS) -c
LDK=	$(LD) -Bshareable


all: $(SOBJS) DYNAMIC

$(SSRCS) DYNAMIC: ../config.h

$(SOBJS): $(SSRCS)
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $(SSRCS) $(SHASH_SRCS:%=../peo/%)

DYNAMIC:	$(DUNIX) $(DUDP) $(DBSD) $(DLINUX) \
		$(DCLASSIC) $(DPEO) $(DMYSQL) $(DPGSQL) $(DREGEX)

$(DUNIX):
	$(DCC) $(DUNIX_SRCS)
	$(LDK) -o $@ $(DUNIX_OBJS)

$(DUDP): 
	$(DCC) $(DUDP_SRCS)
	$(LDK) -o $@ $(DUDP_OBJS)

$(DBSD):
	$(DCC) $(DBSD_SRCS)
	$(LDK) -o $@ $(DBSD_OBJS)

$(DLINUX):
	$(DCC) $(DLINUX_SRCS)
	$(LDK) -o $@ $(DLINUX_OBJS)

$(DDOORS):
	$(DCC) -lpthreads $(DDOORS_SRCS)
	$(LDK) -o $@ $(DDOORS_OBJS)

$(DSTREAMS):
	$(DCC) -lpthreads $(DSTREAMS_SRCS)
	$(LDK) -o $@ $(DSTREAMS_OBJS)

$(DCLASSIC):
	$(DCC) $(DCLASSIC_SRCS)
	$(LDK) -o $@ $(DCLASSIC_OBJS)

$(DPEO):
	$(DCC) $(DPEO_SRCS) $(DHASH_SRCS:%=../peo/%)
	$(LDK) -o $@ $(DPEO_OBJS) $(DHASH_OBJS)

$(DMYSQL):
	$(DCC) $(MYSQL_CPPFLAGS) $(DMYSQL_SRCS)
	$(LDK) -o $@ $(DMYSQL_OBJS)

$(DPGSQL):
	$(DCC) $(PGSQL_CPPFLAGS) $(DPGSQL_SRCS)
	$(LDK) -o $@ $(DPGSQL_OBJS)

$(DREGEX):
	$(DCC) $(DREGEX_SRCS)
	$(LDK) -o $@ $(DREGEX_OBJS)

.PHONY:	clean distclean

clean:
	-rm -f core *.core *.o *.so.* *.so

distclean: clean
	-rm -f Makefile

install:
	@echo "installing shared libraries..."
	@if [ ! -d "$(INSTALL_LIBDIR)" ]; then echo "creating directory $(INSTALL_LIBDIR)" && mkdir -p -m 755 "$(INSTALL_LIBDIR)" ; fi 
	@if [ "$(DUNIX)" -a -f "$(DUNIX)" ]; then $(INSTALL) $(DUNIX) $(INSTALL_LIBDIR)/ && ln -fs $(INSTALL_LIBDIR)/$(DUNIX) $(INSTALL_LIBDIR)/$(DUNIX_PLAIN) && echo "$(INSTALL_LIBDIR)/$(DUNIX)" ; fi
	@if [ "$(DUDP)" -a -f "$(DUDP)" ]; then $(INSTALL) $(DUDP) $(INSTALL_LIBDIR)/ && ln -fs $(INSTALL_LIBDIR)/$(DUDP) $(INSTALL_LIBDIR)/$(DUDP_PLAIN) && echo "$(INSTALL_LIBDIR)/$(DUDP)" ; fi
	@if [ "$(DBSD)" -a -f "$(DBSD)" ]; then $(INSTALL) $(DBSD) $(INSTALL_LIBDIR)/ && ln -fs $(INSTALL_LIBDIR)/$(DBSD) $(INSTALL_LIBDIR)/$(DBSD_PLAIN) && echo "$(INSTALL_LIBDIR)/$(DBSD)" ; fi
	@if [ "$(DLINUX)" -a -f "$(DLINUX)" ]; then $(INSTALL) $(DLINUX) $(INSTALL_LIBDIR)/ && ln -fs $(INSTALL_LIBDIR)/$(DLINUX) $(INSTALL_LIBDIR)/$(DLINUX_PLAIN) && echo "$(INSTALL_LIBDIR)/$(DLINUX)" ; fi
	@if [ "$(DCLASSIC)" -a -f "$(DCLASSIC)" ]; then $(INSTALL) $(DCLASSIC) $(INSTALL_LIBDIR)/ && ln -fs $(INSTALL_LIBDIR)/$(DCLASSIC) $(INSTALL_LIBDIR)/$(DCLASSIC_PLAIN) && echo "$(INSTALL_LIBDIR)/$(DCLASSIC)" ; fi
	@if [ "$(DPEO)" -a -f "$(DPEO)" ]; then $(INSTALL) $(DPEO) $(INSTALL_LIBDIR)/ && ln -fs $(INSTALL_LIBDIR)/$(DPEO) $(INSTALL_LIBDIR)/$(DPEO_PLAIN) && echo "$(INSTALL_LIBDIR)/$(DPEO)" ; fi
	@if [ "$(DMYSQL)" -a -f "$(DMYSQL)" ]; then $(INSTALL) $(DMYSQL) $(INSTALL_LIBDIR)/ && ln -fs $(INSTALL_LIBDIR)/$(DMYSQL) $(INSTALL_LIBDIR)/$(DMYSQL_PLAIN) && echo "$(INSTALL_LIBDIR)/$(DMYSQL)" ; fi
	@if [ "$(DPGSQL)" -a -f "$(DPGSQL)" ]; then $(INSTALL) $(DPGSQL) $(INSTALL_LIBDIR)/ && ln -fs $(INSTALL_LIBDIR)/$(DPGSQL) $(INSTALL_LIBDIR)/$(DPGSQL_PLAIN) && echo "$(INSTALL_LIBDIR)/$(DPGSQL)" ; fi
	@if [ "$(DREGEX)" -a -f "$(DREGEX)" ]; then $(INSTALL) $(DREGEX) $(INSTALL_LIBDIR)/ && ln -fs $(INSTALL_LIBDIR)/$(DREGEX) $(INSTALL_LIBDIR)/$(DREGEX_PLAIN) && echo "$(INSTALL_LIBDIR)/$(DREGEX)" ; fi

